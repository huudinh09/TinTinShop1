(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[105],{"50ed":function(e,t,o){"use strict";o.r(t);var n=o("oA/F"),u=o("JiVo"),i=o("m6w3"),c=o("etRO"),r=o("4jfz"),a=o("mHfP"),p=o("1U+3"),s=o("DY1Z"),l=o("mXGw"),f=o.n(l),g=o("8qar"),m=o.n(g),d=o("UutA"),h=d.default.div.withConfig({displayName:"styles__PopupWrapper",componentId:"sc-1e705dn-0"})(["background:white;position:fixed;bottom:0;left:0;right:0;margin:auto;border-radius:12px 12px 0 0;overflow:hidden;width:375px;height:88px;box-shadow:0 -4px 6px rgba(0,0,0,0.24);z-index:9999;"]),y=d.default.div.withConfig({displayName:"styles__PopupClose",componentId:"sc-1e705dn-1"})(["z-index:2;cursor:pointer;position:absolute;top:0;right:0;width:36px;height:36px;background-image:url(",");&:hover{opacity:0.95;}"],"".concat("https://frontend.tikicdn.com/_desktop-next","/static/img/common-popup-close.svg")),P=d.default.div.withConfig({displayName:"styles__PopupContent",componentId:"sc-1e705dn-2"})(["z-index:1;position:relative;"]),T=o("bGYK"),C=o.n(T),v=o("/m4v"),O=f.a.createElement;function b(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Q(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?b(Object(o),!0).forEach((function(t){Object(i.a)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):b(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=Object(s.a)(e);if(t){var u=Object(s.a)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return Object(p.a)(this,o)}}var w="popup_manager_showed",x=function(e){Object(a.a)(o,e);var t=k(o);function o(e){var r;Object(c.a)(this,o),(r=t.call(this,e)).state={content:null,isPopupVisible:!1},r.showCount=0,r.queue=[],r.timeoutToClose=null,r.timeoutToActive=null,r.timeoutToCheckQueue=null,r.configs={},r.currentPopupId=null,r.isActived=!1,r.clearTimeout=function(e){try{clearTimeout(r[e]),r[e]=null}catch(t){console.log("[PUM] CANNOT CLEAR TIMEOUT",t)}},r.setTimeoutToClose=function(e){clearTimeout("timeoutToClose"),r.timeoutToClose=setTimeout((function(){r.onClose(),"function"===typeof e&&e()}),r.configs.autoCloseTimeout)},r.checkMaxPerPageLoad=function(){return r.showCount<r.configs.maxPerPageLoad},r.updateMaxPerPageLoad=function(){r.showCount++},r.getDefaultQuota=function(){var e={total:0};return Object.keys(r.configs.popupTypes).map((function(t){e[t]=0})),e},r.getLocalQuotaKey=function(){return"".concat(m()().startOf("day").format("X"),"-").concat(m()().endOf("day").format("X"))},r.getQuota=function(){try{var e={};try{e=JSON.parse(localStorage.getItem(w))||{}}catch(o){console.log("[PUM] CANNOT PARSE QUOTA",o)}var t=r.getLocalQuotaKey();return e=Object(i.a)({},t,Q(Q({},r.getDefaultQuota()),e[t]||{})),localStorage.setItem(w,JSON.stringify(e)),e[t]}catch(o){return console.log("[PUM] CANNOT GET QUOTA",o),!1}},r.checkQuotaPerDay=function(){try{var e=r.configs.maxPerDay;return r.getQuota().total<e}catch(t){return console.log("[PUM] CANNOT CHECK QUOTA BER DAY",t),!1}},r.updateQuota=function(e){try{var t=r.getQuota();localStorage.setItem(w,JSON.stringify(Object(i.a)({},r.getLocalQuotaKey(),Q(Q({},t),{},Object(i.a)({total:t.total+1},e,t[e]+1)))))}catch(o){console.log("[PUM] CANNOT UPDATE QUOTA",o)}},r.checkQuotaPerType=function(e){try{var t=r.configs.popupTypes;return r.getQuota()[e]<t[e].maxPerDay}catch(o){return console.log("[PUM] CANNOT CHECK QUOTA PER TYPE",o),!1}},r.checkQuota=function(e){return console.log({checkQuotaPerDay:r.checkQuotaPerDay(),checkQuotaPerType:r.checkQuotaPerType(e),checkMaxPerPageLoad:r.checkMaxPerPageLoad()}),r.checkQuotaPerDay()&&r.checkQuotaPerType(e)&&r.checkMaxPerPageLoad()},r.getPopupFromQueue=function(){if(console.log(Object(u.a)(r.queue)),clearTimeout("timeoutToCheckQueue"),!r.state.isPopupVisible)for(var e=0;e<r.queue.length;e++){var t=r.queue[e],o=t.type,n=t.pid,i=t.content,c=t.onShow,a=t.onClose;if(r.checkQuota(o)&&i){r.currentPopupId=n,r.updateQuota(o),r.updateMaxPerPageLoad(),r.setState({content:i,isPopupVisible:!0}),"function"===typeof c&&c(n),r.setTimeoutToClose(a),r.queue.splice(e,1);break}}},r.pushToQueue=function(e){var t=e.type,o=Object(n.a)(e,["type"]),u=r.configs.popupTypes[t].piority,i=null;r.queue.forEach((function(e,t){null===i&&(e.piority>u&&(i=t),t===r.queue.length-1&&(i=t+1))})),console.log({iIndex:i});var c=C()(10);return r.queue.splice(i||0,0,Q({pid:c,type:t,piority:u},o)),c},r.getRenderContentFunc=function(e){var t=e.type;return function(e){var o=e.content,n=e.onClose,u=e.onShow,i=r.configs.popupTypes;if(!Object.keys(i).includes(t))throw new Error("Type is invalid, supported types: "+Object.keys(i).join(", "));var c=r.pushToQueue({type:t,content:o,onClose:n,onShow:u});return null===r.timeoutToCheckQueue&&r.isActived&&r.getPopupFromQueue(),c}},r.setTimeoutToCheckQueue=function(){clearTimeout("timeoutToCheckQueue"),r.timeoutToCheckQueue=setTimeout((function(){r.getPopupFromQueue()}),r.configs.gapTime)},r.onClose=function(){clearTimeout("timeoutToClose"),r.setState({isPopupVisible:!1}),r.currentPopupId=null,r.setTimeoutToCheckQueue()},r.closePopup=function(e){r.currentPopupId===e&&r.onClose()},r.getProps=function(){return{closePopup:r.closePopup,renderContent:r.getRenderContentFunc}};var a={};try{a=e.remoteConfigs[e.configs.remoteKey]||{}}catch(p){console.log("[PUM] CANNOT ASSIGN REMOTE CONFIG",p)}return r.configs=Q(Q({maxPerDay:4,maxPerPageLoad:1,autoClose:!0,autoCloseTimeout:1e4,activeTimeout:3e3,usingAnimation:!1,gapTime:3e3,popupTypes:{god_banner:{piority:1,maxPerDay:1},crm_promotion:{piority:2,maxPerDay:2},product_review:{piority:3,maxPerDay:1}}},e.configs),a),r}return Object(r.a)(o,[{key:"componentDidMount",value:function(){var e=this;try{window.getPopupManagerConfigs=function(){console.log(e.configs)},window.setPopupManagerConfigs=function(t){e.configs=t}}catch(t){}this.timeoutToActive=setTimeout((function(){e.isActived=!0,e.getPopupFromQueue()}),this.configs.activeTimeout)}},{key:"componentWillUnmount",value:function(){this.clearTimeout("timeoutToActive"),this.clearTimeout("timeoutToCheckQueue"),this.clearTimeout("timeoutToClose")}},{key:"render",value:function(){var e=this,t=this.state,o=t.content,n=t.isPopupVisible,u=this.props.children,i=f.a.Children.map(u,(function(t,o){return f.a.isValidElement(t)?f.a.cloneElement(t,Q({},e.getProps(o))):t}));return O(f.a.Fragment,null,n&&O(h,null,O(y,{onClick:this.onClose,"data-view-id":"popup-manager.close"}),O(P,null,o)),i)}}]),o}(f.a.Component);t.default=Object(v.b)((function(e){var t,o,n,u;return{remoteConfigs:(null===e||void 0===e||null===(t=e.desktop)||void 0===t||null===(o=t.app)||void 0===o||null===(n=o.webConfig)||void 0===n||null===(u=n.desktopWeb)||void 0===u?void 0:u.popupManager)||{}}}))(x)}}]);